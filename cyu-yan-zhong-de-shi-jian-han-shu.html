<!DOCTYPE html>
<html>
    <head>
        <title>C语言中的时间函数 - Frank's zone</title>
        <meta charset="utf-8" />
        <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/theme/static/css/style.css" rel="stylesheet" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    </head>

    <body id="index" class="archive">
        <div class="container">
            <div class="header">
                <ul class="nav nav-pills pull-right">
                    <li class=""><a href="">Home</a></li>
                    <li><a href="/archives.html">Archives</a></li>
                </ul>
                <h3 class="text-muted"><a href="">Frank's zone</a></h3>
				<h2 class="text-muted"></h2>
             </div>
<section id="content" class="article content">
  <header>
    <h2 class="entry-title">
      <a href="/cyu-yan-zhong-de-shi-jian-han-shu.html" rel="bookmark"
         title="Permalink to C语言中的时间函数">C语言中的时间函数</a></h2>
 
  </header>
  
     
  <div class="entry-content">
    <hr />
<h3>asctime（将时间和日期以字符串格式表示）</h3>
<p>相关函数 time，ctime，gmtime，localtime</p>
<p>表头文件 time.h</p>
<p>定义函数
char * asctime(const struct tm * timeptr);</p>
<p>函数说明
asctime()将参数timeptr所指的tm结构中的信息转换成真实世界所使用的时间日期表示方法，然后将结果以字符串形态返回。此函数已经由时区转换成当地时间，字符串格式为:“Wed Jun 30 21:49:08 1993\n”</p>
<p>返回值
若再调用相关的时间日期函数，此字符串可能会被破坏。此函数与ctime不同处在于传入的参数是不同的结构体，一个是sturct tm另一个是time_t。</p>
<p>附加说明
返回一字符串表示目前当地的时间日期。</p>
<p>范例</p>
<div class="highlight"><pre><span class="cp">#include &lt;time.h&gt;</span>
<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">time_t</span> <span class="n">timep</span><span class="p">;</span>
    <span class="n">time</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="o">%</span><span class="n">s</span><span class="err">”</span><span class="p">,</span><span class="n">asctime</span><span class="p">(</span><span class="n">gmtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">)));</span>
<span class="p">}</span>
</pre></div>


<p>执行
Sat Oct 28 02:10:06 2000</p>
<hr />
<h3>ctime（将时间和日期以字符串格式表示）</h3>
<p>相关函数 time，asctime，gmtime，localtime</p>
<p>表头文件time.h</p>
<p>定义函数
char <em>ctime(const time_t </em>timep);</p>
<p>函数说明
ctime()将参数timep所指的time_t结构中的信息转换成真实世界所使用的时间日期表示方法，然后将结果以字符串形态返回。此函数已经由时区转换成当地时间，字符串格式为“Wed Jun 30 21 :49 :08 1993\n”。若再调用相关的时间日期函数，此字符串可能会被破坏。</p>
<p>返回值
返回一字符串表示目前当地的时间日期。</p>
<p>范例</p>
<div class="highlight"><pre><span class="cp">#include&lt;time.h&gt;</span>
<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">time_t</span> <span class="n">timep</span><span class="p">;</span>
    <span class="n">time</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="o">%</span><span class="n">s</span><span class="err">”</span><span class="p">,</span><span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>


<p>执行
Sat Oct 28 10 : 12 : 05 2000</p>
<hr />
<h3>gettimeofday（取得目前的时间）</h3>
<p>相关函数 time，ctime，ftime，settimeofday</p>
<p>表头文件 sys/time.h unistd.h</p>
<p>定义函数
int gettimeofday ( struct timeval * tv , struct timezone * tz )</p>
<p>函数说明
gettimeofday()会把目前的时间有tv所指的结构返回，当地时区的信息则放到tz所指的结构中。
timeval结构定义为:</p>
<div class="highlight"><pre><span class="k">struct</span> <span class="n">timeval</span><span class="p">{</span>
    <span class="kt">long</span> <span class="n">tv_sec</span><span class="p">;</span> <span class="cm">/*秒*/</span>
    <span class="kt">long</span> <span class="n">tv_usec</span><span class="p">;</span> <span class="cm">/*微秒*/</span>
<span class="p">};</span>
</pre></div>


<p>timezone 结构定义为:</p>
<div class="highlight"><pre><span class="k">struct</span> <span class="n">timezone</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">tz_minuteswest</span><span class="p">;</span> <span class="cm">/*和Greenwich 时间差了多少分钟*/</span>
    <span class="kt">int</span> <span class="n">tz_dsttime</span><span class="p">;</span> <span class="cm">/*日光节约时间的状态*/</span>
<span class="p">};</span>
</pre></div>


<p>上述两个结构都定义在/usr/include/sys/time.h。tz_dsttime 所代表的状态如下</p>
<div class="highlight"><pre><span class="n">DST_NONE</span> <span class="cm">/*不使用*/</span>
<span class="n">DST_USA</span> <span class="cm">/*美国*/</span>
<span class="n">DST_AUST</span> <span class="cm">/*澳洲*/</span>
<span class="n">DST_WET</span> <span class="cm">/*西欧*/</span>
<span class="n">DST_MET</span> <span class="cm">/*中欧*/</span>
<span class="n">DST_EET</span> <span class="cm">/*东欧*/</span>
<span class="n">DST_CAN</span> <span class="cm">/*加拿大*/</span>
<span class="n">DST_GB</span> <span class="cm">/*大不列颠*/</span>
<span class="n">DST_RUM</span> <span class="cm">/*罗马尼亚*/</span>
<span class="n">DST_TUR</span> <span class="cm">/*土耳其*/</span>
<span class="n">DST_AUSTALT</span> <span class="cm">/*澳洲（1986年以后）*/</span>
</pre></div>


<p>返回值
成功则返回0，失败返回－1，错误代码存于errno。附加说明EFAULT指针tv和tz所指的内存空间超出存取权限。</p>
<p>范例</p>
<div class="highlight"><pre><span class="cp">#include&lt;sys/time.h&gt;</span>
<span class="cp">#include&lt;unistd.h&gt;</span>
<span class="n">main</span><span class="p">(){</span>
    <span class="k">struct</span> <span class="n">timeval</span> <span class="n">tv</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">timezone</span> <span class="n">tz</span><span class="p">;</span>
    <span class="n">gettimeofday</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">tv</span> <span class="p">,</span> <span class="o">&amp;</span><span class="n">tz</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="n">tv_sec</span><span class="p">;</span> <span class="o">%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span> <span class="n">tv</span><span class="p">,.</span><span class="n">tv_sec</span><span class="p">)</span> <span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="n">tv_usec</span><span class="p">;</span> <span class="o">%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span><span class="n">tv</span><span class="p">.</span><span class="n">tv_usec</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="n">tz_minuteswest</span><span class="p">;</span> <span class="o">%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span> <span class="n">tz</span><span class="p">.</span><span class="n">tz_minuteswest</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="n">tz_dsttime</span><span class="p">,</span> <span class="o">%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span><span class="n">tz</span><span class="p">.</span><span class="n">tz_dsttime</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>执行
tv_sec: 974857339</p>
<p>tv_usec:136996</p>
<p>tz_minuteswest:-540</p>
<p>tz_dsttime:0</p>
<hr />
<h3>gmtime（取得目前时间和日期）</h3>
<p>相关函数 time,asctime,ctime,localtime</p>
<p>表头文件time.h</p>
<p>定义函数 struct tm<em>gmtime(const time_t</em>timep);</p>
<p>函数说明 gmtime()将参数timep 所指的time_t 结构中的信息转换成真实世界所使用的时间日期表示方法，然后将结果由结构tm返回。</p>
<p>结构tm的定义为</p>
<div class="highlight"><pre><span class="k">struct</span> <span class="n">tm</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">tm_sec</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tm_min</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tm_hour</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tm_mday</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tm_mon</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tm_year</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tm_wday</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tm_yday</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tm_isdst</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="n">tm_sec</span> <span class="err">代表目前秒数，正常范围为</span><span class="mi">0</span><span class="o">-</span><span class="mi">59</span><span class="err">，但允许至</span><span class="mi">61</span><span class="err">秒</span>
<span class="kt">int</span> <span class="n">tm_min</span> <span class="err">代表目前分数，范围</span><span class="mi">0</span><span class="o">-</span><span class="mi">59</span>
<span class="kt">int</span> <span class="n">tm_hour</span> <span class="err">从午夜算起的时数，范围为</span><span class="mi">0</span><span class="o">-</span><span class="mi">23</span>
<span class="kt">int</span> <span class="n">tm_mday</span> <span class="err">目前月份的日数，范围</span><span class="mo">01</span><span class="o">-</span><span class="mi">31</span>
<span class="kt">int</span> <span class="n">tm_mon</span> <span class="err">代表目前月份，从一月算起，范围从</span><span class="mi">0</span><span class="o">-</span><span class="mi">11</span>
<span class="kt">int</span> <span class="n">tm_year</span> <span class="err">从</span><span class="mi">1900</span> <span class="err">年算起至今的年数</span>
<span class="kt">int</span> <span class="n">tm_wday</span> <span class="err">一星期的日数，从星期一算起，范围为</span><span class="mi">0</span><span class="o">-</span><span class="mi">6</span>
<span class="kt">int</span> <span class="n">tm_yday</span> <span class="err">从今年</span><span class="mi">1</span><span class="err">月</span><span class="mi">1</span><span class="err">日算起至今的天数，范围为</span><span class="mi">0</span><span class="o">-</span><span class="mi">365</span>
<span class="kt">int</span> <span class="n">tm_isdst</span> <span class="err">日光节约时间的旗标</span>
</pre></div>


<p>此函数返回的时间日期未经时区转换，而是UTC时间。</p>
<p>返回值 返回结构tm代表目前UTC 时间</p>
<p>范例</p>
<div class="highlight"><pre><span class="cp">#include &lt;time.h&gt;</span>
<span class="n">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">wday</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Sun&quot;</span><span class="p">,</span><span class="s">&quot;Mon&quot;</span><span class="p">,</span><span class="s">&quot;Tue&quot;</span><span class="p">,</span><span class="s">&quot;Wed&quot;</span><span class="p">,</span><span class="s">&quot;Thu&quot;</span><span class="p">,</span><span class="s">&quot;Fri&quot;</span><span class="p">,</span><span class="s">&quot;Sat&quot;</span><span class="p">};</span>
    <span class="kt">time_t</span> <span class="n">timep</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">tm</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
    <span class="n">time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">);</span>
    <span class="n">p</span><span class="o">=</span><span class="n">gmtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="o">%</span><span class="n">d</span><span class="o">%</span><span class="n">d</span><span class="o">%</span><span class="n">d</span><span class="err">”</span><span class="p">,(</span><span class="mi">1900</span><span class="o">+</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_year</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_mon</span><span class="p">),</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_mday</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="o">%</span><span class="n">s</span><span class="o">%</span><span class="n">d</span><span class="p">;</span><span class="o">%</span><span class="n">d</span><span class="p">;</span><span class="o">%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span> <span class="n">wday</span><span class="p">[</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_wday</span><span class="p">],</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_hour</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_min</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_sec</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>执行
2000/10/28 Sat 8:15:38</p>
<hr />
<h3>localtime（取得当地目前时间和日期）</h3>
<p>相关函数 time, asctime, ctime, gmtime</p>
<p>表头文件time.h</p>
<p>定义函数 struct tm *localtime(const time_t * timep);</p>
<p>函数说明 localtime()将参数timep所指的time_t结构中的信息转换成真实世界所使用的时间日期表示方法，然后将结果由结构tm返回。结构tm的定义请参考gmtime()。此函数返回的时间日期已经转换成当地时区。</p>
<p>返回值 返回结构tm代表目前的当地时间。</p>
<p>范例</p>
<div class="highlight"><pre><span class="cp">#include&lt;time.h&gt;</span>
<span class="n">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">wday</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="err">“</span><span class="n">Sun</span><span class="err">”</span><span class="p">,</span><span class="err">”</span><span class="n">Mon</span><span class="err">”</span><span class="p">,</span><span class="err">”</span><span class="n">Tue</span><span class="err">”</span><span class="p">,</span><span class="err">”</span><span class="n">Wed</span><span class="err">”</span><span class="p">,</span><span class="err">”</span><span class="n">Thu</span><span class="err">”</span><span class="p">,</span><span class="err">”</span><span class="n">Fri</span><span class="err">”</span><span class="p">,</span><span class="err">”</span><span class="n">Sat</span><span class="err">”</span><span class="p">};</span>
    <span class="kt">time_t</span> <span class="n">timep</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">tm</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
    <span class="n">time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">);</span>
    <span class="n">p</span><span class="o">=</span><span class="n">localtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">);</span> <span class="cm">/*取得当地时间*/</span>
    <span class="n">printf</span> <span class="p">(</span><span class="err">“</span><span class="o">%</span><span class="n">d</span><span class="o">%</span><span class="n">d</span><span class="o">%</span><span class="n">d</span> <span class="err">”</span><span class="p">,</span> <span class="p">(</span><span class="mi">1900</span><span class="o">+</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_year</span><span class="p">),(</span> <span class="n">l</span><span class="o">+</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_mon</span><span class="p">),</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_mday</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="o">%</span><span class="n">s</span><span class="o">%</span><span class="n">d</span><span class="o">:%</span><span class="n">d</span><span class="o">:%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span> <span class="n">wday</span><span class="p">[</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_wday</span><span class="p">],</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_hour</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_min</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">tm_sec</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>执行
2000/10/28 Sat 11:12:22</p>
<hr />
<h3>mktime（将时间结构数据转换成经过的秒数）</h3>
<p>相关函数 time，asctime，gmtime，localtime</p>
<p>表头文件time.h</p>
<p>定义函数 time_t mktime(strcut tm * timeptr);</p>
<p>函数说明 mktime()用来将参数timeptr所指的tm结构数据转换成从公元1970年1月1日0时0分0 秒算起至今的UTC时间所经过的秒数。</p>
<p>返回值 返回经过的秒数。</p>
<p>范例
/<em> 用time()取得时间（秒数），利用localtime()
转换成struct tm 再利用mktine（）将struct tm转换成原来的秒数</em>/</p>
<div class="highlight"><pre><span class="cp">#include&lt;time.h&gt;</span>
<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">time_t</span> <span class="n">timep</span><span class="p">;</span>
    <span class="n">strcut</span> <span class="n">tm</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
    <span class="n">time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="n">time</span><span class="p">()</span> <span class="o">:</span> <span class="o">%</span><span class="n">d</span> <span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span><span class="n">timep</span><span class="p">);</span>
    <span class="n">p</span><span class="o">=</span><span class="n">localtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timep</span><span class="p">);</span>
    <span class="n">timep</span> <span class="o">=</span> <span class="n">mktime</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="n">time</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">localtime</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">mktime</span><span class="p">()</span><span class="o">:%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span><span class="n">timep</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>执行
time():974943297</p>
<p>time()-&gt;localtime()-&gt;mktime():974943297</p>
<hr />
<h3>settimeofday（设置目前时间）</h3>
<p>相关函数 time，ctime，ftime，gettimeofday</p>
<p>表头文件 sys/time.h unistd.h</p>
<p>定义函数 int settimeofday ( const struct timeval <em>tv,const struct timezone </em>tz);</p>
<p>函数说明 settimeofday()会把目前时间设成由tv所指的结构信息，当地时区信息则设成tz所指的结构。详细的说明请参考gettimeofday()。注意，只有root权限才能使用此函数修改时间。</p>
<p>返回值
成功则返回0，失败返回－1，错误代码存于errno。</p>
<p>错误代码
EPERM 并非由root权限调用settimeofday（），权限不够。</p>
<p>EINVAL 时区或某个数据是不正确的，无法正确设置时间。</p>
<hr />
<h3>time（取得目前的时间）</h3>
<p>相关函数 ctime，ftime，gettimeofday</p>
<p>表头文件time.h</p>
<p>定义函数 time_t time(time_t *t);</p>
<p>函数说明 此函数会返回从公元1970年1月1日的UTC时间从0时0分0秒算起到现在所经过的秒数。如果t 并非空指针的话，此函数也会将返回值存到t指针所指的内存。</p>
<p>返回值
成功则返回秒数，失败则返回((time_t)-1)值，错误原因存于errno中。</p>
<p>范例</p>
<div class="highlight"><pre><span class="cp">#include&lt;time.h&gt;</span>
<span class="n">mian</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">seconds</span><span class="o">=</span> <span class="n">time</span><span class="p">((</span><span class="kt">time_t</span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="err">“</span><span class="o">%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span><span class="n">seconds</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>执行
9.73E+08</p>
  </div><!-- /.entry-content -->
   <footer class="post-info text-muted">
    Posted on <abbr class="published" title="2014-06-09T00:00:00">
      一 09 六月 2014
    </abbr>
    <address class="vcard author">
      by <a class="url fn" href="/author/frank.html">Frank</a>
    </address> in <a href="/category/dev.html">Dev</a> Tagged <a href="/tag/c.html">C </a><a href="/tag/time.html">time </a>  </footer><!-- /.post-info -->
</section>
            <footer id="contentinfo" class="footer">
                    <nav class="pull-right bottom-nav">
                        <a href="/None">RSS</a>
                    </nav>
                    <address id="about" class="vcard body">
                    &copy; <a href="">Frank's zone</a> Proudly powered by <a href="http://getpelican.com/">Pelican</a>
                    </address><!-- /#about -->
            </footer><!-- /#contentinfo -->
        </div><!-- container -->
    </body>
</html>